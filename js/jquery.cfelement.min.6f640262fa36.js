/* CFElement * version: 2.0 * date: 07.2012 * author: Vadim Zozulja * mail: vadimzw@gmail.com */
function createOptionsList(n){var r=".CFEselectListItemText",u=".CFEarrowUp",t="option",i=".CFEselectListItem",f=".CFEselectListContainer";$CFE_select=$(n),$visRows=$CFE_select.find(f).attr("visrows"),$selectList=$CFE_select.find(".CFEselectList"),$CFEList=$selectList.find(".CFEList"),$selectList.find(i).remove(),$CFEscroll=$CFE_select.find(".CFEscroll"),$CFE_select.find(t).each(function(){var t="</span></div>",n=this;$(n).is(":selected")?($CFEList.append('<div class="CFEselectListItem CFEselectedItem"><span class="CFEselectListItemText">'+$(n).html()+t),$CFE_select.find(".CFEselectText").html($(n).html())):$CFEList.append('<div class="CFEselectListItem"><span class="CFEselectListItemText">'+$(n).html()+t),$(n).is(":disabled")&&$CFEList.find(".CFEselectListItem:last").addClass("CFEselectListItemDisabled")}),$CFE_select.find(t).size()>$visRows?($listHeight=$selectList.find(i).innerHeight()*$CFE_select.find(t).size(),$listOverHeight=$selectList.find(i).innerHeight()*$visRows,$CFEscroll.length==1?($CFEscroll.height($listOverHeight),$scrollWidth=Number($CFEscroll.css("width").replace("px","")),$trackHeight=$listOverHeight-$CFEscroll.find(u).height()-$CFEscroll.find(".CFEarrowDown").height(),$CFEscroll.find(".CFEsliderTrack").height($trackHeight).css("top",$CFEscroll.find(u).height()),$CFEsliderHeight=$listOverHeight*100/$listHeight,$CFEscroll.find(".CFEslider").height($CFEsliderHeight),$CFEscroll.show()):$scrollWidth=scrollbarWidth(),$selectList.css({height:$listOverHeight,"padding-right":$scrollWidth})):($selectList.css({height:"auto","padding-right":0}),$CFEscroll.hide()),$textWidth=$selectList.find(r).innerWidth(),$selectList.find(r).each(function(){$textWidth<$(this).innerWidth()&&($textWidth=$(this).innerWidth())}),$textWidth>$CFE_select.width()?$selectList.width($textWidth):$selectList.width("auto"),$CFE_select.find(f).css({display:"none",visibility:"visible"})}function scrollbarWidth(){return $scrollbarOuter=$('<div style="position:absolute; top:-200px; left:-200px; height:50px;"></div>'),$scrollbarInner=$('<div style="width:100px; height:100px;">test</div>'),$scrollbarOuter.append($scrollbarInner),$("body").append($scrollbarOuter),$widht1=$scrollbarOuter.width(),$scrollbarOuter.css("overflow-y","scroll"),$widht2=$scrollbarOuter.width(),$widht2-$widht1==0&&($widht1=$scrollbarOuter[0].clientWidth),$scrollbarOuter.remove(),$widht2-$widht1}function CFEselectEvents(){var f="CFEselectListItemHover",r=".CFEselectListItem",o="CFEselectListItemDisabled",i=".CFEselectListContainer:visible",u="CFEselect_active",t="CFEselect_focus",n="span.CFEselect",e=".CFEselectListContainer";$(document).unbind("click"),$(document).click(function(i){$(i.target).parents().filter(".CFEselect").length!=1&&($(e).hide(),$(n).removeClass(t).removeClass(u))}),$(n).unbind("click"),$(n).click(function(f){var l="selected",a="CFEselectedItem",k=".CFEselectListItemText",b="CFEselectListItem",y="100%",v="auto",c="999",h="z-index",w="CFEscroll",p="select",s=this;if($(s).addClass(t),$CFEselect=$(s),!$(s).find(p).is(":disabled")){if($curListContainer=$(s).find(e),$(n).not($(s)).removeClass(t),$(i).not($curListContainer).hide(),$curListContainer.is(":visible")){if($(f.target).parent().hasClass(w)||$(f.target).parent().parent().hasClass(w))return;$(s).removeClass(u),$curListContainer.hide()}else $curListContainer.show(),$(s).addClass(u),$topPosition=$(s).offset().top+$(s).height()-$(window).scrollTop(),$windowHeight=$(window).height(),$leftPosition=$(s).offset().left,$windowWidth=$(window).width(),$curWidth=$curListContainer.find(".CFEselectList").outerWidth(),$topPosition+$curListContainer.height()>$windowHeight?($(s).css(h,c),$curListContainer.css({top:v,bottom:y}),$leftPosition+$curWidth>$windowWidth&&($(s).css(h,c),$curListContainer.css("left",$curListContainer.width()-$curWidth))):$leftPosition+$curWidth>$windowWidth?($(s).css(h,c),$curListContainer.css("left",$curListContainer.width()-$curWidth),$topPosition+$curListContainer.height()<=$windowHeight&&$curListContainer.css({top:y,bottom:v})):$(s).css(h)==c&&($zIndex=$(s).find(p).css(h),$(s).css(h,$zIndex),$curListContainer.css({top:y,bottom:v,left:"0"})),$(s).find(".CFEscroll").length&&scrollEvents($CFEselect);if($(f.target).hasClass(b)||$(f.target).hasClass("CFEselectListItemText")){if($curItem=$(f.target).hasClass(b)?$(f.target).find(k):$(f.target),$curItem.parent().hasClass(a)||$curItem.parent().hasClass(o))return;$curIndex=$(s).find(k).index($curItem),$(s).find(r).filter(".CFEselectedItem").removeClass(a),$curItem.parent().addClass(a),$curOptions=$(s).find("option"),$curOptions.removeAttr(l),$curOptions.eq($curIndex).attr(l,l),$(s).find(".CFEselectText").html($curItem.html()),$(s).find(p).change()}}}),$(r).unbind("hover"),$(r).hover(function(){$(this).hasClass(o)||$(this).addClass(f)},function(){$(this).removeClass(f)}),$(n).unbind("focus"),$(n).unbind("blur"),$(n).focus(function(){$(this).addClass(t)}).blur(function(){$(this).removeClass(t),$(this).find(i).hide()}),$(document).unbind("keydown"),$(document).keydown(function(r){r.keyCode==9&&($(n).not(":focus").find(i).hide(),$(n).not(":focus").removeClass(t)),r.keyCode==38&&changeSelectedItem(-1),r.keyCode==40&&changeSelectedItem(1)})}function changeSelectedItem(n){var i="selected",r="CFEselectedItem",t=".CFEselectListItem";$curFocusSelect=$("span.CFEselect").filter(".CFEselect_focus"),$curFocusSelect.length&&($curSelectedItem=$curFocusSelect.find(".CFEselectedItem"),$curSelectedIndex=$curFocusSelect.find(t).index($curSelectedItem),$newIndex=$curSelectedIndex+n,$newIndex<=0&&($newIndex=0),$newIndex>=$curFocusSelect.find(t).length&&($newIndex=$curFocusSelect.find(t).length-1),$curSelectedItem.removeClass(r),$newSelectedItem=$curFocusSelect.find(t).eq($newIndex),$newSelectedItem.addClass(r),$curFocusSelect.find(".CFEselectText").text($newSelectedItem.text()),$curFocusSelect.find("option:selected").removeAttr(i),$curFocusSelect.find("option").eq($newIndex).attr(i,i),$curFocusSelect.find("select").change()),$curFocusSelect.find(".CFEselectListContainer").is(":visible")&&scrollEvents($curFocusSelect)}function scrollEvents(n){var o="mousewheel",f=".CFEcustomScroll",r="click",e=".CFEselectListItem",i=100;function t(n){$top=n,$top<=-$maxTop&&($top=-$maxTop),$top>=0&&($top=0),$CFEList.css("top",$top),$temp=$top*i/$maxTop,$sliderTop=-($maxSliderTop*$temp)/i,u()}function u(){$sliderTop>=$maxSliderTop&&($sliderTop=$maxSliderTop),$sliderTop<=0&&($sliderTop=0),$CFEslider.css("top",$sliderTop)}function s(){$CFEselectListItem=$CFE_select.find(".CFEselectedItem"),$curIndex=$CFEList.find(e).index($CFEselectListItem),$top=$delta*$curIndex,t(-$top)}$CFE_select=$(n),$CFEList=$CFE_select.find(".CFEList"),$CFEsliderTrack=$CFE_select.find(".CFEsliderTrack"),$CFEslider=$CFE_select.find(".CFEslider"),$CFEarrowUp=$CFE_select.find(".CFEarrowUp"),$CFEarrowDown=$CFE_select.find(".CFEarrowDown"),$delta=$CFE_select.find(e).height(),$top=$CFEList.position().top,$maxTop=$CFEList.height()-$CFEList.parent().height(),$maxSliderTop=$CFEsliderTrack.height()-$CFEslider.height(),s(),$CFEslider.unbind("mousedown"),$CFEslider.mousedown(function(n){n.preventDefault(),$startPos=n.pageY,$sliderTop=$CFEslider.position().top,$CFEsliderTrack.mousemove(function(n){$sliderTop+=n.pageY-$startPos,$startPos=n.pageY,u(),$temp=$sliderTop*i/$maxSliderTop,$listTop=$maxTop*$temp/i,t(-$listTop)}),$(document).unbind("mouseup"),$(document).mouseup(function(){$CFEsliderTrack.unbind("mousemove")})}),$CFEarrowUp.unbind(r),$CFEarrowUp.click(function(){$top+=$delta,t($top)}),$CFEarrowDown.unbind(r),$CFEarrowDown.click(function(){$top-=$delta,t($top)}),$CFEsliderTrack.unbind(r),$CFEsliderTrack.click(function(n){$(n.target).hasClass("CFEsliderTrack")&&($sliderTop=n.pageY-$CFEsliderTrack.offset().top-$CFEslider.height()/2,u(),$temp=$sliderTop*i/$maxSliderTop,$listTop=$maxTop*$temp/i,t(-$listTop))}),$(f).unbind(o),$(f).bind(o,function(n,i){n.preventDefault(),typeof $delta!="undefined"&&(i<=-1?($top-=$delta,t($top)):($top+=$delta,t($top)))})}function CFEchkEvents(){var n=".CFEcheckbox";$(n).unbind("click"),$(n).click(function(){var t="CFEcheckbox_checked",n=this;$curChk=$(n).find("input"),$curChk.is(":enabled")&&($(n).hasClass(t)?($(n).removeClass(t),$curChk.attr("checked",!1)):($(n).addClass(t),$curChk.attr("checked",!0)),$curChk.change())})}function CFEradioEvents(){var n=".CFEradio";$(n).unbind("click"),$(n).click(function(){var i="CFEradio_checked",r="input",t=this;if($curRadio=$(t).find(r),$curRadio.is(":enabled")){if($curName=$(t).attr("name"),$radioList=$(n).filter("[name="+$curName+"]"),$radioChecked=$radioList.filter(".CFEradio_checked"),$(t).hasClass(i))return;$radioChecked.removeClass(i),$radioChecked.find(r).attr("checked",!1),$(t).addClass(i),$(t).find(r).attr("checked",!0),$curRadio.change()}})}jQuery.fn.CFElement=function(n){var i="disabled",c=":checked",v='" style="z-index:',r='"></span>',f='" tabindex="',h='" class="',s='<span id="',o="z-index",e=":disabled",t="id",u="tabindex",a="input:radio",l="input:checkbox";function y(n){$elem=$(n),$elem.is("select")&&(w($elem),$selectCounter++),$elem.is(l)&&(b($elem),$chkCounter++),$elem.is(a)&&p($elem)}function w(i){var c="CFEselect";$num=$selectCounter,$class=c,$disabled="",$zindex=$allElem-$elemCounter,$visRows=n.selectvisibleRows,$scrollWidht=0,$tabindex=$(i).attr(u),$id=$(i).attr(t)?"CFE-"+$(i).attr(t):c+$num,$(i).is(e)&&($disabled=' disabled="disabled"',$class="CFEselect CFEselect_disabled"),n.customScroll?($CFEscroll=n.showArrows?'<div class="CFEscroll"><div class="CFEsliderTrack"><div class="CFEslider"><span class="CFEslider_t"></span><span class="CFEslider_b"></span></div></div><div class="CFEarrowUp"></div><div class="CFEarrowDown"></div></div>':'<div class="CFEscroll"><div class="CFEsliderTrack"><div class="CFEslider"><span class="CFEslider_t"></span><span class="CFEslider_b"></span></div></div></div>',$listClass="CFEselectList CFEcustomScroll"):($listClass="CFEselectList",$CFEscroll=""),$(i).css(o,$zindex),$(i).wrap(s+$id+h+$class+f+$tabindex+'"'+$disabled+' style="z-index:'+$zindex+r).hide().after('<span class="CFEselect_lItem"></span><span class="CFEselectTextItem"><span class="CFEselectText"></span></span><span class="CFEselect_rItem"></span><div class="CFEselectListContainer" visrows="'+$visRows+'"><div class="'+$listClass+'">'+$CFEscroll+'<div class="CFEList"></div></div></div>'),$CFE_select=$(i).parent(),$CFE_select.width($(i).width()),$textWidht=$CFE_select.width()-$CFE_select.find(".CFEselect_lItem").width()-$CFE_select.find(".CFEselect_rItem").width(),$CFE_select.find(".CFEselectText").width($textWidht),createOptionsList($CFE_select)}function b(n){var l="CFEcheckbox";$num=$chkCounter,$class=l,$zindex=$allElem-$elemCounter,$tabindex=$(n).attr(u),$id=$(n).attr(t)?"CFE-"+$(n).attr(t):l+$num,$(n).css(o,$zindex),$(n).wrap(s+$id+h+$class+f+$tabindex+v+$zindex+r).hide(),$(n).is(c)&&$(n).parent().addClass("CFEcheckbox_checked"),$(n).is(e)&&($(n).parent().attr(i,i),$(n).parent().addClass("CFEcheckbox_disabled"))}function p(n){var t="CFEradio";$class=t,$name=t+$(n).attr("name"),$zindex=$allElem-$elemCounter,$tabindex=$(n).attr(u),$(n).css(o,$zindex),$(n).wrap('<span class="'+$class+f+$tabindex+v+$zindex+'" name="'+$name+r).hide(),$(n).is(c)&&$(n).parent().addClass("CFEradio_checked"),$(n).is(e)&&($(n).parent().attr(i,i),$(n).parent().addClass("CFEradio_disabled"))}var n=jQuery.extend({customScroll:!1,showArrows:!1,selectvisibleRows:5},n);return $allElem=$(this).length,$elemCounter=0,$selectCounter=0,$chkCounter=0,this.each(function(n){y(this),n++,$elemCounter=n,n==$allElem&&($("select").length!=0&&CFEselectEvents(),$(l).length!=0&&CFEchkEvents(),$(a).length!=0&&CFEradioEvents())})},jQuery.fn.CFEchangeDisabled=function(){var r="CFEradio_disabled",i="input:radio",u="CFEcheckbox_disabled",e="input:checkbox",t="disabled",f="CFEselect_disabled",n=this;$(n).is(":disabled")?($(n).is("select")&&$(n).parent().addClass(f).attr(t,!0),$(n).is(e)&&$(n).parent().addClass(u).attr(t,!0),$(n).is(i)&&$(n).parent().addClass(r).attr(t,!0)):($(n).is("select")&&$(n).parent().removeClass(f).attr(t,!1),$(n).is(e)&&$(n).parent().removeClass(u).attr(t,!1),$(n).is(i)&&$(n).parent().removeClass(r).attr(t,!1))},jQuery.fn.CFEchangeOptions=function(){$CFE_select=$(this).parent(),$CFE_select.find(".CFEselectListContainer").css({display:"block",visibility:"hidden"}),createOptionsList($CFE_select),CFEselectEvents()};